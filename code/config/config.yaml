# 主配置文件
# 论文项目：距离感知对比学习稠密检索 (DACL-DR)

# 模型配置
model:
  encoder_name: "./local_model_backbone"
  embedding_dim: 768
  pooling_type: "cls"  # cls, mean, max
  normalize: true
  shared_encoder: true  # 共享backbone

# 训练配置
training:
  batch_size: 128
  learning_rate: 2e-5
  encoder_learning_rate: 2e-5  # 与DPR论文一致，统一使用2e-5
  warmup_steps: 1000
  max_grad_norm: 1.0
  gradient_accumulation_steps: 4  # Stage2/3有7 hard neg，物理batch=32×4=有效batch128
  bf16: true  # BF16推荐：指数范围与FP32一致，低温度系数下不会溢出
  seed: 42
  weight_decay: 0.01
  early_stopping:
    enabled: true
    patience: 10      # 三阶段模型容忍10个epoch无改善（Stage2需足够时间学习hard neg）；Baseline使用patience=3
    monitor: eval_recall@5
    mode: max

# 三阶段训练配置（三阶段只改变负例来源，w全程恒定）
three_stage_training:
  enabled: true
  stage1_epochs: 4    # In-Batch负例
  stage2_epochs: 8    # BM25难负例
  stage3_epochs: 12   # 模型难负例

# 损失函数配置
loss:
  temperature: 0.05
  distance_weight: 0.6  # w in L_total = L_InfoNCE + w * L_dis

# 难负例挖掘配置
hard_negative:
  num_negatives: 7
  bm25_candidates: 100
  mining_source: "training_pool"  # 从训练数据文档池挖掘
  mining_top_k: 200
  mining_keep: 50

# 索引配置
index:
  type: "hnsw"
  hnsw:
    M: 32
    ef_construction: 200
    ef_search: 128

# 评估配置
evaluation:
  metrics:
    - "recall@1"
    - "recall@5"
    - "recall@10"
    - "recall@20"
    - "recall@100"
    - "mrr@10"
    - "ndcg@10"
# 数据路径
data:
  nq_train: "data_set/NQ/nq-train.json"
  nq_dev: "data_set/NQ/nq-dev.json"
  nq_test: "data_set/NQ/nq-test.csv"
  trivia_train: "data_set/TriviaQA/trivia-train.json"
  trivia_dev: "data_set/TriviaQA/trivia-dev.json"
  trivia_test: "data_set/TriviaQA/trivia-test.csv"
  corpus: "data_set/psgs_w100.tsv"
  cache_dir: "cache/"

# 输出配置
output:
  checkpoint_dir: "checkpoints/"
  log_dir: "logs/"
  results_dir: "results/"
  figures_dir: "figures/"